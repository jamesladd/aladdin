You are an expert at creating minimal Outlook Mail Add-ins using the latest Version Overrides 1.1 and vanilla html, css and javascript.
Your goal is to create an add-in that knows when an email is selected, store it and when it is no longer selected notify an API.

You MUST use https://jamesladd.github.io/aladdin as the Url for Add-in sources and assets.
You MUST put CSS in its own file not inline.
you MUST not add code that was not requested.
You MUST make sure that the Add-in works in both Outlook Web and Desktop.
You need to support Taskpane.
You do not need to support Commands.
You MUST put UI related functions into the aladdin.js file. Do not create a taskpane.js file.

When responding to a request you MUST describe what you did in detail and why you did it, and include the full file
sources for changed or new files only.

You MUST start with the following base aladdin.js file and modify it to achieve the requested outcomes:

// aladdin.js

const singleton = [false]

export function createAladdin(Office) {
  if (typeof window !== 'undefined' && window.aladdinInstance) return window.aladdinInstance;
  if (singleton[0]) return singleton[0];
  const instance = aladdin(Office)
  if (typeof window !== 'undefined') window.aladdinInstance = instance;
  if (typeof window === 'undefined') singleton[0] = instance;
  instance.loadState()
  instance.watchState()
  return instance
}

function aladdin(Office) {
  return {
    Office,
    _currentItemId: null,
    _state: {
      events: [],
    },
    state() {
      // return the current state
      return this._state
    },
    saveState() {
      // save the current state to local storage
    },
    loadState() {
      // load the current state from local storage
    },
    watchState() {
      // listen to local storage to know when it changed
    },
    event(name, details) {
      // record event named 'name' in state and store
    },
    initialize() {
    },
    notify() {
    },
    async getCategories() {
      // Should API call fail, use default below.
      return [
        { displayName: 'InboxAgent', color: '#f54900' }
      ]
    }
  }
}

You MUST start with the following runtime.js and modify it to achieve the requested outcomes:

// runtime.js - Runtime initialization

import { createAladdin } from './aladdin.js'

// Wait for Office to be available
function initializeRuntime() {
  if (typeof Office === 'undefined') {
    console.error('Office is not defined - Office.js may not be loaded')
    return
  }

  // Office.onReady initialization
  Office.onReady((info) => {
    console.log('Office.onReady called', info)
    if (info.host === Office.HostType.Outlook) {
      const addin = createAladdin(Office)
      addin.initialize()
    }
  })
}

// Call initialization
initializeRuntime()

You MUST start with the following taskpane.html and modify it to achieve the requested outcomes:

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>InboxAgent Taskpane</title>

    <!-- Load Office.js first -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>

    <link rel="stylesheet" href="taskpane.css">
</head>
<body>
<div class="container">
    <div id="status">Loading...</div>
    <div class="section-title">Recent Events</div>
    <div id="events" class="events"></div>
</div>

<!-- Load runtime.js as a module AFTER Office.js -->
<script type="module" src="runtime.js"></script>
</body>
</html>

You MUST start with the following taskpane.css file and modify it to achieve the reuqested outcomes:

/* taskpane.css */

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f5f5f5;
    color: #333;
    font-size: 14px;
    line-height: 1.5;
}

.container {
    padding: 20px;
    max-width: 800px;
    margin: 0 auto;
}

.user-info {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.user-name {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 8px;
}

.platform {
    font-size: 14px;
    opacity: 0.9;
    font-weight: 400;
    margin-top: 4px;
}

.section-title {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 15px;
    color: #555;
}

.events {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.event-item {
    background: white;
    padding: 15px;
    border-radius: 6px;
    border-left: 4px solid #667eea;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s, box-shadow 0.2s;
}

.event-item:hover {
    transform: translateX(2px);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
}

.event-name {
    font-weight: 600;
    color: #667eea;
    margin-bottom: 5px;
    font-size: 14px;
}

.event-timestamp {
    font-size: 11px;
    color: #999;
    margin-bottom: 8px;
}

.event-details {
    font-size: 13px;
    color: #666;
    background: #f9f9f9;
    padding: 8px;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    white-space: pre-wrap;
    word-break: break-word;
    max-height: 200px;
    overflow-y: auto;
}

.no-events {
    text-align: center;
    color: #999;
    padding: 40px 20px;
    font-style: italic;
}

/* Responsive adjustments */
@media (max-width: 480px) {
    .container {
        padding: 15px;
    }

    .user-info {
        padding: 15px;
    }

    .user-name {
        font-size: 16px;
    }
}

You MUST start with the following valid manifest.xml file:

<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<OfficeApp
        xmlns="http://schemas.microsoft.com/office/appforoffice/1.1"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:bt="http://schemas.microsoft.com/office/officeappbasictypes/1.0"
        xmlns:mailappor="http://schemas.microsoft.com/office/mailappversionoverrides/1.0"
        xsi:type="MailApp">

    <!-- Basic Settings -->
    <Id>8a8e3d85-8f9d-4b1e-9c3d-7a6b5c4dbeef</Id>
    <Version>1.47.0.0</Version>
    <ProviderName>Aportio</ProviderName>
    <DefaultLocale>en-US</DefaultLocale>
    <DisplayName DefaultValue="InboxAgent A"/>
    <Description DefaultValue="Tracks email events and displays user activity"/>
    <IconUrl DefaultValue="https://jamesladd.github.io/aladdin/assets/icon-64.png"/>
    <HighResolutionIconUrl DefaultValue="https://jamesladd.github.io/aladdin/assets/icon-128.png"/>
    <SupportUrl DefaultValue="https://jamesladd.github.io/aladdin/support"/>

    <!-- Hosts -->
    <Hosts>
        <Host Name="Mailbox"/>
    </Hosts>

    <Requirements>
        <Sets>
            <Set Name="Mailbox" MinVersion="1.8"/>
        </Sets>
    </Requirements>

    <!-- Form Settings -->
    <FormSettings>
        <Form xsi:type="ItemRead">
            <DesktopSettings>
                <SourceLocation DefaultValue="https://jamesladd.github.io/aladdin/taskpane.html"/>
                <RequestedHeight>450</RequestedHeight>
            </DesktopSettings>
        </Form>
    </FormSettings>

    <!-- Permissions -->
    <Permissions>ReadWriteMailbox</Permissions>

    <!-- Activation Rule: Always show in taskpane for mail items -->
    <Rule xsi:type="RuleCollection" Mode="Or">
        <Rule xsi:type="ItemIs" ItemType="Message" FormType="Read"/>
        <Rule xsi:type="ItemIs" ItemType="Message" FormType="Edit"/>
        <Rule xsi:type="ItemIs" ItemType="Appointment" FormType="Read"/>
        <Rule xsi:type="ItemIs" ItemType="Appointment" FormType="Edit"/>
    </Rule>

    <DisableEntityHighlighting>false</DisableEntityHighlighting>

    <!-- Version Overrides 1.0 (Root) -->
    <VersionOverrides xmlns="http://schemas.microsoft.com/office/mailappversionoverrides" xsi:type="VersionOverridesV1_0">

        <Requirements>
            <bt:Sets DefaultMinVersion="1.8">
                <bt:Set Name="Mailbox"/>
            </bt:Sets>
        </Requirements>

        <Hosts>
            <Host xsi:type="MailHost">
                <DesktopFormFactor>
                    <ExtensionPoint xsi:type="MessageReadCommandSurface">
                        <OfficeTab id="TabDefault">
                            <Group id="msgReadGroup">
                                <Label resid="GroupLabel"/>
                                <Control xsi:type="Button" id="msgReadOpenPaneButton">
                                    <Label resid="TaskpaneButton.Label"/>
                                    <Supertip>
                                        <Title resid="TaskpaneButton.Label"/>
                                        <Description resid="TaskpaneButton.Tooltip"/>
                                    </Supertip>
                                    <Icon>
                                        <bt:Image size="16" resid="Icon.16x16"/>
                                        <bt:Image size="32" resid="Icon.32x32"/>
                                        <bt:Image size="80" resid="Icon.80x80"/>
                                    </Icon>
                                    <Action xsi:type="ShowTaskpane">
                                        <SourceLocation resid="Taskpane.Url"/>
                                    </Action>
                                </Control>
                            </Group>
                        </OfficeTab>
                    </ExtensionPoint>

                    <ExtensionPoint xsi:type="MessageComposeCommandSurface">
                        <OfficeTab id="TabDefault">
                            <Group id="msgComposeGroup">
                                <Label resid="GroupLabel"/>
                                <Control xsi:type="Button" id="msgComposeOpenPaneButton">
                                    <Label resid="TaskpaneButton.Label"/>
                                    <Supertip>
                                        <Title resid="TaskpaneButton.Label"/>
                                        <Description resid="TaskpaneButton.Tooltip"/>
                                    </Supertip>
                                    <Icon>
                                        <bt:Image size="16" resid="Icon.16x16"/>
                                        <bt:Image size="32" resid="Icon.32x32"/>
                                        <bt:Image size="80" resid="Icon.80x80"/>
                                    </Icon>
                                    <Action xsi:type="ShowTaskpane">
                                        <SourceLocation resid="Taskpane.Url"/>
                                    </Action>
                                </Control>
                            </Group>
                        </OfficeTab>
                    </ExtensionPoint>

                    <ExtensionPoint xsi:type="AppointmentOrganizerCommandSurface">
                        <OfficeTab id="TabDefault">
                            <Group id="apptOrganizerGroup">
                                <Label resid="GroupLabel"/>
                                <Control xsi:type="Button" id="apptOrganizerOpenPaneButton">
                                    <Label resid="TaskpaneButton.Label"/>
                                    <Supertip>
                                        <Title resid="TaskpaneButton.Label"/>
                                        <Description resid="TaskpaneButton.Tooltip"/>
                                    </Supertip>
                                    <Icon>
                                        <bt:Image size="16" resid="Icon.16x16"/>
                                        <bt:Image size="32" resid="Icon.32x32"/>
                                        <bt:Image size="80" resid="Icon.80x80"/>
                                    </Icon>
                                    <Action xsi:type="ShowTaskpane">
                                        <SourceLocation resid="Taskpane.Url"/>
                                    </Action>
                                </Control>
                            </Group>
                        </OfficeTab>
                    </ExtensionPoint>

                    <ExtensionPoint xsi:type="AppointmentAttendeeCommandSurface">
                        <OfficeTab id="TabDefault">
                            <Group id="apptAttendeeGroup">
                                <Label resid="GroupLabel"/>
                                <Control xsi:type="Button" id="apptAttendeeOpenPaneButton">
                                    <Label resid="TaskpaneButton.Label"/>
                                    <Supertip>
                                        <Title resid="TaskpaneButton.Label"/>
                                        <Description resid="TaskpaneButton.Tooltip"/>
                                    </Supertip>
                                    <Icon>
                                        <bt:Image size="16" resid="Icon.16x16"/>
                                        <bt:Image size="32" resid="Icon.32x32"/>
                                        <bt:Image size="80" resid="Icon.80x80"/>
                                    </Icon>
                                    <Action xsi:type="ShowTaskpane">
                                        <SourceLocation resid="Taskpane.Url"/>
                                    </Action>
                                </Control>
                            </Group>
                        </OfficeTab>
                    </ExtensionPoint>
                </DesktopFormFactor>
            </Host>
        </Hosts>

        <Resources>
            <bt:Images>
                <bt:Image id="Icon.16x16" DefaultValue="https://jamesladd.github.io/aladdin/assets/icon-16.png"/>
                <bt:Image id="Icon.32x32" DefaultValue="https://jamesladd.github.io/aladdin/assets/icon-32.png"/>
                <bt:Image id="Icon.80x80" DefaultValue="https://jamesladd.github.io/aladdin/assets/icon-80.png"/>
            </bt:Images>
            <bt:Urls>
                <bt:Url id="Taskpane.Url" DefaultValue="https://jamesladd.github.io/aladdin/taskpane.html"/>
            </bt:Urls>
            <bt:ShortStrings>
                <bt:String id="GroupLabel" DefaultValue="Aladdin"/>
                <bt:String id="TaskpaneButton.Label" DefaultValue="Show Aladdin"/>
            </bt:ShortStrings>
            <bt:LongStrings>
                <bt:String id="TaskpaneButton.Tooltip" DefaultValue="Open the Aladdin taskpane to view email events"/>
            </bt:LongStrings>
        </Resources>

        <!-- Nested VersionOverrides 1.1 for SupportsPinning -->
        <VersionOverrides xmlns="http://schemas.microsoft.com/office/mailappversionoverrides/1.1" xsi:type="VersionOverridesV1_1">

            <Requirements>
                <bt:Sets DefaultMinVersion="1.8">
                    <bt:Set Name="Mailbox"/>
                </bt:Sets>
            </Requirements>

            <Hosts>
                <Host xsi:type="MailHost">
                    <DesktopFormFactor>
                        <ExtensionPoint xsi:type="MessageReadCommandSurface">
                            <OfficeTab id="TabDefault">
                                <Group id="msgReadGroup">
                                    <Label resid="GroupLabel"/>
                                    <Control xsi:type="Button" id="msgReadOpenPaneButton">
                                        <Label resid="TaskpaneButton.Label"/>
                                        <Supertip>
                                            <Title resid="TaskpaneButton.Label"/>
                                            <Description resid="TaskpaneButton.Tooltip"/>
                                        </Supertip>
                                        <Icon>
                                            <bt:Image size="16" resid="Icon.16x16"/>
                                            <bt:Image size="32" resid="Icon.32x32"/>
                                            <bt:Image size="80" resid="Icon.80x80"/>
                                        </Icon>
                                        <Action xsi:type="ShowTaskpane">
                                            <SourceLocation resid="Taskpane.Url"/>
                                            <SupportsPinning>true</SupportsPinning>
                                        </Action>
                                    </Control>
                                </Group>
                            </OfficeTab>
                        </ExtensionPoint>

                        <ExtensionPoint xsi:type="MessageComposeCommandSurface">
                            <OfficeTab id="TabDefault">
                                <Group id="msgComposeGroup">
                                    <Label resid="GroupLabel"/>
                                    <Control xsi:type="Button" id="msgComposeOpenPaneButton">
                                        <Label resid="TaskpaneButton.Label"/>
                                        <Supertip>
                                            <Title resid="TaskpaneButton.Label"/>
                                            <Description resid="TaskpaneButton.Tooltip"/>
                                        </Supertip>
                                        <Icon>
                                            <bt:Image size="16" resid="Icon.16x16"/>
                                            <bt:Image size="32" resid="Icon.32x32"/>
                                            <bt:Image size="80" resid="Icon.80x80"/>
                                        </Icon>
                                        <Action xsi:type="ShowTaskpane">
                                            <SourceLocation resid="Taskpane.Url"/>
                                            <SupportsPinning>true</SupportsPinning>
                                        </Action>
                                    </Control>
                                </Group>
                            </OfficeTab>
                        </ExtensionPoint>

                        <ExtensionPoint xsi:type="AppointmentOrganizerCommandSurface">
                            <OfficeTab id="TabDefault">
                                <Group id="apptOrganizerGroup">
                                    <Label resid="GroupLabel"/>
                                    <Control xsi:type="Button" id="apptOrganizerOpenPaneButton">
                                        <Label resid="TaskpaneButton.Label"/>
                                        <Supertip>
                                            <Title resid="TaskpaneButton.Label"/>
                                            <Description resid="TaskpaneButton.Tooltip"/>
                                        </Supertip>
                                        <Icon>
                                            <bt:Image size="16" resid="Icon.16x16"/>
                                            <bt:Image size="32" resid="Icon.32x32"/>
                                            <bt:Image size="80" resid="Icon.80x80"/>
                                        </Icon>
                                        <Action xsi:type="ShowTaskpane">
                                            <SourceLocation resid="Taskpane.Url"/>
                                        </Action>
                                    </Control>
                                </Group>
                            </OfficeTab>
                        </ExtensionPoint>

                        <ExtensionPoint xsi:type="AppointmentAttendeeCommandSurface">
                            <OfficeTab id="TabDefault">
                                <Group id="apptAttendeeGroup">
                                    <Label resid="GroupLabel"/>
                                    <Control xsi:type="Button" id="apptAttendeeOpenPaneButton">
                                        <Label resid="TaskpaneButton.Label"/>
                                        <Supertip>
                                            <Title resid="TaskpaneButton.Label"/>
                                            <Description resid="TaskpaneButton.Tooltip"/>
                                        </Supertip>
                                        <Icon>
                                            <bt:Image size="16" resid="Icon.16x16"/>
                                            <bt:Image size="32" resid="Icon.32x32"/>
                                            <bt:Image size="80" resid="Icon.80x80"/>
                                        </Icon>
                                        <Action xsi:type="ShowTaskpane">
                                            <SourceLocation resid="Taskpane.Url"/>
                                        </Action>
                                    </Control>
                                </Group>
                            </OfficeTab>
                        </ExtensionPoint>
                    </DesktopFormFactor>
                </Host>
            </Hosts>

            <Resources>
                <bt:Images>
                    <bt:Image id="Icon.16x16" DefaultValue="https://jamesladd.github.io/aladdin/assets/icon-16.png"/>
                    <bt:Image id="Icon.32x32" DefaultValue="https://jamesladd.github.io/aladdin/assets/icon-32.png"/>
                    <bt:Image id="Icon.80x80" DefaultValue="https://jamesladd.github.io/aladdin/assets/icon-80.png"/>
                </bt:Images>
                <bt:Urls>
                    <bt:Url id="Taskpane.Url" DefaultValue="https://jamesladd.github.io/aladdin/taskpane.html"/>
                </bt:Urls>
                <bt:ShortStrings>
                    <bt:String id="GroupLabel" DefaultValue="Aladdin"/>
                    <bt:String id="TaskpaneButton.Label" DefaultValue="Show Aladdin"/>
                </bt:ShortStrings>
                <bt:LongStrings>
                    <bt:String id="TaskpaneButton.Tooltip" DefaultValue="Open the Aladdin taskpane to view email events"/>
                </bt:LongStrings>
            </Resources>

        </VersionOverrides>

    </VersionOverrides>

</OfficeApp>


Update the files to enable the addin to do the following:

1. Listen to all events that can be listened to by a Web and Desktop enabled add-in, and call event() passing the name and details of the event.
2. Get the name of the current user and show it as the first entry in the Taskpane.
3. Get the name of the current inbox or folder and show that after the current user. Use the internet headers to try to extract folder information when available.
4. Get the Office context platform and show that after the current inbox.
5. Get the Office version and show that after the platform.
6. On initialization of the addin, call the intialize function passing in the name of the current user, name of the current inbox / folder,
   the office platform and version.
7. When an email is selected capture the following email item information:
   a. To
   b. From
   c. CC
   d. Subject
   e. Attachment information (the names of attachments)
   f. Raw email headers with Office context mailbox item getAllInternetHeadersAsync, and convert the string into key/value pairs.
8. When a different email is selected or no email is selected the current captured email information is to be sent to an API
   by calling the notify function.
   The API end-point for this POST is /api/inboxnotify
9. When the current email detail has been sent with the notify function the current email details in the state can be deleted.
10. To ensure that the current email details are available across different activations of the addin the email details should
    be stored in state and persisted in localstorage.
11. LocalStorage should be watched so any activation of the addin can see what the current selected email details are.
12. When the add-in is initialized call getCategories to get a list of categories that must be added to the list of masterCategories.
    getCategories should be passed the all the information captured in 2, 3, 4 and 5.
    The API end-point for this POST is /api/inboxinit
13. Do not create a poll for changes for e.g. setInterval. Assume the regular raising of events keep things in sync.
14. Check for getAsync before using async methods to get item fields: To, From, Subject, CC, categories and flags; and use async if available.
15. You MUST register event handlers at the correct API level: use Office.context.mailbox.addHandlerAsync() for mailbox-level events (ItemChanged, OfficeThemeChanged) and use Office.context.mailbox.item.addHandlerAsync() for item-level events (RecipientsChanged, AttachmentsChanged, RecurrenceChanged, AppointmentTimeChanged, EnhancedLocationsChanged), and you MUST check that Office.context.mailbox.item exists before attempting to register item-level event handlers.
16. You MUST only register events that are actually supported by the Outlook Javascript API.
17. You Must only keep the last 10 events.
18. You log the name of the event passed to the event function to the console.

